{% if site.coderwall_user %}
<section>
  <h1>Coderwall</h1>
  <ul id="cw_badges">
    <li class="loading">Status updating...</li>
  </ul>
  {% if site.coderwall_endorse %}
  <div>
    <a href="http://coderwall.com/{{site.coderwall_user}}" target="_blank" class="cw_badge">{% if site.coderwall_endrosecount %}<img
       alt="Endorse {{site.coderwall_user}} on Coderwall"
       src="http://api.coderwall.com/{{site.coderwall_user}}/endorsecount.png" />{%else%}<img
       alt="Endorse {{site.coderwall_user}} on Coderwall"
       src="http://api.coderwall.com/{{site.coderwall_user}}/endorse.png" />{% endif %}</a>
  </div>
  {% endif %}

  <script type="text/javascript">
    var coderwall = (function(){
      function render(options, badges){
        var fragment = '',
            t = $(options.target),
            height = 65,
            width = 65,
            index;

        for (index in badges) {
          fragment += '<a class="cw_badge"title="' + badges[index].description + '" target="_blank" href="http://coderwall.com/' + options.user + '">';
          fragment +=   '<img alt="' + badges[index].description + '" height="' + width + '" width="' + height + '" src="' + badges[index].badge + '"/>';
          fragment += '</a>';
        }

        t.html(fragment);
      }
      return {
        showBadges: function(options){
          $.ajax({
              url: 'http://coderwall.com/' + options.user + '.json?callback=?'
            , dataType: 'jsonp'
            , error: function (err) { $(options.target + ' li.loading').addClass('error').text("Error loading feed"); }
            , success: function(res) {
                render(options, res.data.badges);
            }
          });
        }
      };
    })();

    $(document).ready(function(){
      coderwall.showBadges({
        user: '{{site.coderwall_user}}',
        target: '#cw_badges'
      });
    });
  </script>
</section>
{% endif %}
